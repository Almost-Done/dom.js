<html>
    <head>
        <title>dom.js</title>
        <style type="text/css">

div {
    padding: 0.5em;
    clear: left;
}

#contents {
    border: 2px solid gray;
    margin: 0.5em;
}

span {
    float: left;
    width: 15em;
}
.significant {
    color: gray;
}

.covered {
    color: green;
}

.partial {
    color: orange;
}

.uncovered {
    color: red;
}
        </style>
        <script type="application/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script type="application/javascript">
<!--

function txt(text) {
    return document.createTextNode(text);
}

function div() {
    var rv = document.createElement('div');
    for (var i = 0; i < arguments.length; i++) {
        rv.appendChild(arguments[i]);
    }
    return rv;
}

function span(cls, text) {
    var rv = document.createElement('span');
    rv.setAttribute('class', cls);
    rv.appendChild(txt(text));
    return rv;
}

var if_modified_since = null;

function poll_server_forever() {
    /*
    http://api.jquery.com/jQuery.get/
    "If a request with jQuery.get() returns an error code, it will fail silently unless the script has also called the global .ajaxError() method"
    Thus if the server doesn't respond correctly then we break out of the polling loop. The page must be refreshed at this point to start it again.
    */
    var headers = {};
    var url = 'coverage.json';
    if (if_modified_since) {
        headers['if-modified-since'] = if_modified_since;
        url += '?after=' + encodeURIComponent(if_modified_since);
    }
    jQuery.ajax(url, {
        complete: function(data) {
            var contents = document.getElementById('contents');
            contents.innerHTML = '';
            contents.appendChild(div(txt(new Date().toUTCString())));
            var response = JSON.parse(data['responseText']);
            if_modified_since = data.getResponseHeader('last-modified');
            for (var filename in response) {
                var file_data = response[filename];
                var file_div = div(
                    txt(filename),
                    div(
                        span('significant', 'Significant: ' + file_data['significant']),
                        span('covered', 'Covered: ' + file_data['covered']),
                        span('partial', 'Partial: ' + file_data['partial']),
                        span('uncovered', 'Uncovered: ' + file_data['partial'])));
                contents.appendChild(file_div);
            }
            poll_server_forever();
        },
        headers: headers,
    });
}

poll_server_forever();

-->
        </script>
    </head>
    <body>
        <h1>dom.js</h1>
        <div id="contents">Please wait, generating profile...</div>
    </body>
</html>
